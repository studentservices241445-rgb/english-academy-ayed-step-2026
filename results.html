<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ูุชูุฌุฉ ุงุฎุชุจุงุฑ ุชุญุฏูุฏ ุงููุณุชูู | ุงูุฏูุฑุฉ ุงูููุซูุฉ STEP 2026</title>

  <!-- Styles -->
  <link rel="stylesheet" href="./assets/styles.css?v=2026-01-20" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- ูู ุนูุฏู ุฎุท Cairo ุฏุงุฎู CSS ุชุฌุงูู ุงูุฑูุงุจุท -->
</head>

<body class="theme-gold">
  <!-- Header -->
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="./index.html" aria-label="ุงูุฑุฆูุณูุฉ">
        <span class="brand__logo">โ</span>
        <span class="brand__text">
          <strong>ุฃูุงุฏูููุฉ ุนุงูุฏ</strong>
          <small>ุงูุฏูุฑุฉ ุงูููุซูุฉ STEP 2026</small>
        </span>
      </a>

      <nav class="nav">
        <a class="nav__link" href="./index.html">ุงูุฑุฆูุณูุฉ</a>
        <a class="nav__link" href="./course-content.html">ูุญุชูู ุงูุฏูุฑุฉ</a>
        <a class="nav__link" href="./faq.html">ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ</a>
        <a class="nav__link" href="./support.html">ุงูุฏุนู</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero hero--compact">
    <div class="container">
      <div class="hero-card">
        <h1 class="hero-title">ูุชูุฌุฉ ุงุฎุชุจุงุฑ ุชุญุฏูุฏ ุงููุณุชูู โ</h1>
        <p class="hero-subtitle">
          ููุง ูุทูุน ูู ุชุญููู ูุงุถุญ + ุฎุทุฉ ูุฐุงูุฑุฉ ุชูุดูู ุตุญ ุญุณุจ ููุช ุงุฎุชุจุงุฑู ููุณุชูุงู.
        </p>

        <div class="hero-badges">
          <div class="badge">
            <span class="badge__label">ูุณุจุชู</span>
            <span class="badge__value" id="scorePercent">โ</span>
          </div>
          <div class="badge">
            <span class="badge__label">ุฅุฌูุงูู ุงูุตุญ</span>
            <span class="badge__value" id="scoreRaw">โ</span>
          </div>
          <div class="badge">
            <span class="badge__label">ูุชู ุงุฎุชุจุงุฑู</span>
            <span class="badge__value" id="examWindowText">โ</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main -->
  <main class="container section">
    <!-- Notice if no result -->
    <div class="card card--warn" id="noResult" style="display:none">
      <h2>ูุง ููููุง ูุชูุฌุฉ ุงุฎุชุจุงุฑ ๐</h2>
      <p>ูุงุถุญ ุฅูู ูุง ูููุช ุงูุงุฎุชุจุงุฑ ุฃู ูุชุญุช ุตูุญุฉ ุงููุชุงุฆุฌ ูุจุงุดุฑุฉ.</p>
      <div class="actions">
        <a class="btn btn--primary" href="./level-test.html">ุงุจุฏุฃ ุงุฎุชุจุงุฑ ุชุญุฏูุฏ ุงููุณุชูู</a>
        <a class="btn btn--ghost" href="./index.html">ุฑุฌูุน ููุฑุฆูุณูุฉ</a>
      </div>
    </div>

    <!-- Result content -->
    <div id="resultWrap" style="display:none">
      <!-- ุชุญููู ุงูุฃูุณุงู -->
      <section class="grid grid-2">
        <div class="card">
          <h2 class="card-title">ุชุญููู ุงูุฃูุณุงู</h2>
          <p class="muted">ูุจู ูุนุฑู ููู ุชุฑูุฒ ุนุดุงู ููุชู ูุง ูุถูุน.</p>
          <div class="bars" id="sectionBars"></div>

          <div class="tip">
            <strong>ููุงุญุธุฉ:</strong>
            ุงูุฎุทุฉ ุงููู ุชุญุช ูุจููุฉ ุนูู ูุชูุฌุชู + ููุช ุงุฎุชุจุงุฑู + ุฃุณููุจ ูุฐุงูุฑุชู.
          </div>
        </div>

        <!-- ููุงุท ุงูุถุนู -->
        <div class="card">
          <h2 class="card-title">ุฃููู ููุทุชูู ุชุญุชุงุฌ ุชุฑููุฒ</h2>
          <p class="muted">ููุง ุจูููู โูุฑู ุงูุฏุฑุฌุงุชโ ุบุงูุจุงู.</p>

          <ul class="focus-list" id="weakList"></ul>

          <div class="actions">
            <a class="btn btn--ghost" href="./level-test.html">ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ (ุฃุณุฆูุฉ ูุฎุชููุฉ)</a>
          </div>
        </div>
      </section>

      <!-- ุงูุฎุทุฉ -->
      <section class="section">
        <div class="card card--lux">
          <h2 class="card-title">ุฎุทุชู ุงูููุชุฑุญุฉ ๐</h2>
          <p class="muted" id="planIntro"></p>

          <div class="plan" id="planBody"></div>

          <div class="divider"></div>

          <!-- ุงูุณุนุฑ ูุธูุฑ ููุง ุจุนุฏ ุงูุงุฎุชุจุงุฑ -->
          <div class="pricing-box">
            <div class="pricing-box__left">
              <div class="price">
                <span class="price__label">ุณุนุฑ ุงูุงุดุชุฑุงู ุจุนุฏ ุงูุงุฎุชุจุงุฑ</span>
                <span class="price__now" id="priceNow">349 ุฑ.ุณ</span>
                <span class="price__note">ูุฑุฌุน <strong>599 ุฑ.ุณ</strong> ุจุนุฏ ุงูุชูุงู ุงูููุงุนุฏ / ููุงูุฉ ุงูุนุฑุถ.</span>
              </div>
              <div class="seats">
                <span class="seats__label">ุงูููุงุนุฏ ุงููุชุจููุฉ</span>
                <span class="seats__value" id="seatsLeft">โ</span>
                <span class="seats__note" id="seatsNote"></span>
              </div>
            </div>

            <div class="pricing-box__right">
              <a class="btn btn--primary btn--lg" href="./register.html">ุฃุจุบู ุฃุณุฌู ุงูุขู โ</a>
              <a class="btn btn--ghost btn--lg" href="./course-content.html">ุฃุจู ุฃุดูู ูุญุชูู ุงูุฏูุฑุฉ</a>
            </div>
          </div>

          <div class="mini-note">
            ุจุนุฏ ูุง ุชุณุฌู ูุชุฑุณู ุงูุฅูุตุงูโฆ ูุชู ุชูุนููู ุจุฃูุฑุจ ููุช (ุบุงูุจุงู ุจููุณ ุงูุฏูููุฉ/ุงูุณุงุนุฉ) ุญุณุจ ูุตูู ุงูุญูุงูุฉ.
          </div>
        </div>
      </section>

      <!-- ูุฑุงุฌุนุฉ ุณุฑูุนุฉ ูุฃุฎุทุงุก ุงูุทุงูุจ -->
      <section class="section">
        <div class="card">
          <h2 class="card-title">ูุฑุงุฌุนุฉ ุณุฑูุนุฉ ูุฃุฎุทุงุกู</h2>
          <p class="muted">
            ุนุดุงู ูุง ุชูุฑุฑ ููุณ ุงูุบูุท. (ุงููุฑุงุฌุนุฉ ูุฎุชุตุฑุฉ + ุดุฑุญ ุจุณูุท)
          </p>

          <div class="review" id="reviewWrap"></div>
        </div>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container footer-inner">
      <div class="footer-links">
        <a href="./privacy.html">ุณูุงุณุฉ ุงูุฎุตูุตูุฉ</a>
        <a href="./terms.html">ุงูุดุฑูุท ูุงูุฃุญูุงู</a>
        <a href="./refund.html">ุณูุงุณุฉ ุงูุงุณุชุฑุฌุงุน</a>
      </div>
      <div class="footer-copy">ยฉ <span id="y"></span> ุฃูุงุฏูููุฉ ุนุงูุฏ โ ุฌููุน ุงูุญููู ูุญููุธุฉ.</div>
    </div>
  </footer>

  <!-- App scripts -->
  <script src="./assets/app.js?v=2026-01-20"></script>

  <script>
    // ========== ุฅุนุฏุงุฏุงุช ุนุงูุฉ ==========
    document.getElementById("y").textContent = new Date().getFullYear();

    const STORAGE_KEY = "ayed_step_level_test_v1";
    const dataRaw = localStorage.getItem(STORAGE_KEY);

    const noResult = document.getElementById("noResult");
    const resultWrap = document.getElementById("resultWrap");

    const scorePercent = document.getElementById("scorePercent");
    const scoreRaw = document.getElementById("scoreRaw");
    const examWindowText = document.getElementById("examWindowText");

    const sectionBars = document.getElementById("sectionBars");
    const weakList = document.getElementById("weakList");

    const planIntro = document.getElementById("planIntro");
    const planBody = document.getElementById("planBody");

    const reviewWrap = document.getElementById("reviewWrap");

    // ========== ูุณุงุนุฏุงุช ==========
    const esc = (s) => String(s || "").replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"
    }[m]));

    const pct = (n) => `${Math.round(n)}%`;

    const windowLabel = (w) => {
      const map = {
        "7days": "ุฎูุงู ุฃุณุจูุน",
        "14days": "ุฎูุงู ุฃุณุจูุนูู",
        "30days": "ุฎูุงู ุดูุฑ",
        "60days": "ุฎูุงู ุดูุฑูู",
        "90days": "ุฎูุงู 3 ุดููุฑ",
        "more": "ุจุนุฏ 3 ุดููุฑ"
      };
      return map[w] || "ุบูุฑ ูุญุฏุฏ";
    };

    // ========== ููุงุนุฏ ูุชุจููุฉ (ุชูุงุฒูู) ==========
    // ููุงุญุธุฉ: ูุฐุง ุนุฏูุงุฏ ุชุณูููู ุฏุงุฎู ุงููุชุตูุญ (LocalStorage) โ ุจุณูุท ููู ูุนุงู
    const SEATS_KEY = "ayed_seats_left_v1";
    const SEATS_TOUCH_KEY = "ayed_seats_touch_v1";

    function initSeats() {
      let seats = Number(localStorage.getItem(SEATS_KEY));
      if (!Number.isFinite(seats) || seats <= 0) seats = 33; // ุงูุจุฏุงูุฉ ุงููุทููุจุฉ

      // ูููุต ููุนุฏ ูุฑุฉ ูุญุฏุฉ ููู ุฒุงุฆุฑ (ุฃูู ูุฑุฉ) ุนุดุงู ูุง ูููุต ูู ุชุญุฏูุซ
      const touched = localStorage.getItem(SEATS_TOUCH_KEY);
      if (!touched) {
        seats = Math.max(1, seats - (Math.random() < 0.7 ? 1 : 0)); // ุบุงูุจุงู ูููุต 1
        localStorage.setItem(SEATS_TOUCH_KEY, "1");
      }

      // ุฅุฐุง ูุฑุจ ูุฎูุตุ ูุถูู 10 ููุงุนุฏ "ุจุณุจุจ ูุซุฑุฉ ุงูุทูุจ" ูุฑุฉ ูุญุฏุฉ
      let note = "";
      if (seats <= 5) {
        seats += 10;
        note = "ุชูุช ุฅุถุงูุฉ ููุงุนุฏ ุฅุถุงููุฉ ุจุณุจุจ ูุซุฑุฉ ุงูุทูุจ ๐ฅ";
      }

      localStorage.setItem(SEATS_KEY, String(seats));
      return { seats, note };
    }

    function paintSeats(seats, note) {
      const el = document.getElementById("seatsLeft");
      const noteEl = document.getElementById("seatsNote");
      el.textContent = seats + " ููุนุฏ";

      noteEl.textContent = note || (seats <= 10 ? "ุจุงูู ุนุฏุฏ ูุญุฏูุฏโฆ ูุง ุชุคุฌู ๐" : "");

      // ุชุบููุฑ ููู ุงูุฅุทุงุฑ ุญุณุจ ุงูุนุฏุฏ
      const box = document.querySelector(".pricing-box");
      if (!box) return;
      box.classList.remove("seats-low", "seats-mid", "seats-high");
      if (seats <= 10) box.classList.add("seats-low");
      else if (seats <= 20) box.classList.add("seats-mid");
      else box.classList.add("seats-high");
    }

    // ========== ุงูุฎุทุฉ ==========
    function buildPlan(profile, perSection) {
      const examWin = profile?.examWindow || "30days";
      const minutes = Number(profile?.studyTime || 60);
      const style = profile?.learningStyle || "mixed";

      // ุชุฑุชูุจ ุงูุฃูุณุงู ูู ุงูุฃุถุนู ููุฃููู
      const rows = Object.entries(perSection || {}).map(([sec, v]) => {
        const acc = v.total ? (v.correct / v.total) : 0;
        return { sec, correct: v.correct, total: v.total, acc };
      }).sort((a,b) => a.acc - b.acc);

      const weak = rows.slice(0, 2).map(r => r.sec);
      const strong = rows.slice(-1).map(r => r.sec);

      const timeLine =
        minutes >= 120 ? "ููุชุงุฒโฆ ููุชู ูููู ูุชุบุทูุฉ ูู ุดูุก ุจุดูู ููู." :
        minutes >= 60 ? "ููุช ููุชุงุฒ ููุทูุน ุจูุชูุฌุฉ ูููุฉ ุฅุฐุง ุงูุชุฒูุช." :
        "ุญุชู ูู ููุชู ููููโฆ ููุดู ุจุฎุทุฉ ุฐููุฉ ุชุฑูุฒ ุนูู ุงููู ูุฌูุจ ุฏุฑุฌุงุช ุจุณุฑุนุฉ.";

      const styleLine =
        style === "videos" ? "ุจูุง ุฃูู ุชูุถูู ุงูุดุฑุญ ุงููุฑุฆู: ุฎู ุชุฑููุฒู ุนูู ุงููุญุงุถุฑุงุช + ุชุทุจูู ูุจุงุดุฑ ุจุนุฏ ูู ุฌุฒุก." :
        style === "practice" ? "ุจูุง ุฃูู ุชูุถูู ุงูุชุทุจูู: ุจูุฎูู ุงูุญู ูุงูุชุตุญูุญ ูุญูุฑ ุงูุฎุทุฉ." :
        "ุจููุดู ุจูุฒูุฌ: ุดุฑุญ ุณุฑูุน + ุชุทุจูู + ูุฑุงุฌุนุฉ ูุฑูุฒุฉ.";

      const winLine =
        examWin === "7days" ? "ุงุฎุชุจุงุฑู ูุฑูุจ ุฌุฏูุงโฆ ููุง ุฎุทุฉ ุถุบุท ุฐููุฉ (ุจุฏูู ุชุดุชุช)." :
        examWin === "14days" ? "ุงุฎุชุจุงุฑู ูุฑูุจโฆ ุจููุงุฒู ุจูู ุงูุชุฃุณูุณ ูุงูุชุฌููุนุงุช." :
        examWin === "30days" ? "ูุฏุงูู ููุช ููุชุงุฒโฆ ุจูุจูู ุฃุณุงุณ ุซู ููุซูู ุงูููุงุฐุฌ." :
        examWin === "60days" ? "ูุฏุงูู ููุช ุฌูููโฆ ุจูุซุจุช ุงูููุงุนุฏ ุซู ูุฑูุน ุณุฑุนุชู ุจุงูุชุฌููุนุงุช." :
        examWin === "90days" ? "ููุช ูุฑูุญโฆ ูุฑุชูุจ ูู ุงูุฃูุณุงู ููุทูุน ุจูุชูุฌุฉ ูููุฉ ุจุฅุฐู ุงููู." :
        "ูุนู ููุชโฆ ุงูุฃูุถู ููุดู ุจุฎุทุฉ ุชุฏุฑูุฌูุฉ ุจุฏูู ุถุบุท.";

      const lines = [];
      lines.push(`<p><strong>${esc(winLine)}</strong></p>`);
      lines.push(`<p>${esc(timeLine)}<br>${esc(styleLine)}</p>`);

      // ูุงูุจ ุฎุทุฉ ุญุณุจ ููุช ุงูุงุฎุชุจุงุฑ
      const planBlocks = [];

      const focusText = weak.length
        ? `ุฃูู ุดูุก ุนูุฏู ุงูุขู: ูุฑูุน ${esc(weak[0])}${weak[1] ? " + " + esc(weak[1]) : ""} ูุฃููุง ุธุงูุฑุฉ ูุฃุถุนู ููุงุท ุนูุฏู.`
        : "ุจูุฑููุฒ ุนูู ุงูุฃูุณุงู ุงููู ุชุญุชุงุฌ ุฑูุน ุณุฑูุน.";

      planBlocks.push(`
        <div class="plan-block">
          <h3>1) ุชุฑููุฒู ุงูุฑุฆูุณู</h3>
          <ul>
            <li>${focusText}</li>
            <li>ุจุนุฏ ูู ุฌุฒุก: ุญู ูุจุงุดุฑ + ุชุตุญูุญ (ุงูุณุฑ ููุง).</li>
            <li>ูุง ุชุฌูุน ูุตุงุฏุฑโฆ ุฎูู ุนูู ูุญุชูู ุงูุฏูุฑุฉ ุนุดุงู ูุง ุชุชุดุชุช.</li>
          </ul>
        </div>
      `);

      if (examWin === "7days") {
        planBlocks.push(`
          <div class="plan-block">
            <h3>2) ุฎุทุฉ 7 ุฃูุงู (ุถุบุท ุฐูู)</h3>
            <ol>
              <li><strong>ููู 1-2:</strong> ููุงุนุฏ ูููุฉ + ุชููููุงุช ุงูุญู ุงูุณุฑูุน (Grammar) + ุชุทุจูู.</li>
              <li><strong>ููู 3:</strong> Reading: ุงุณุชุฑุงุชูุฌูุงุช + ูุทุน ูุชูุฑุฑุฉ + ุชุตุญูุญ ุฃุฎุทุงุกู.</li>
              <li><strong>ููู 4:</strong> Listening: ุงุณุชุฑุงุชูุฌูุงุช + ููุงุฐุฌ + ุฑูุน ุงูุชุฑููุฒ.</li>
              <li><strong>ููู 5:</strong> ูุฑุงุฌุนุฉ ูุฑูุฒุฉ ุนูู ุฃุฎุทุงุก ุงูุงุฎุชุจุงุฑ + ููุงุท ุถุนูู.</li>
              <li><strong>ููู 6:</strong> ูููุฐุฌ ูุงูู + ุชุตุญูุญ + ุชุซุจูุช ุงูุชููููุงุช.</li>
              <li><strong>ููู 7:</strong> ูุฑุงุฌุนุฉ ุฎูููุฉ + ุฃูู ุงููุชูุฑุฑ + ููู ุจุฏุฑู.</li>
            </ol>
            <p class="muted">ุงููุฏู ููุง: โุชุซุจูุช ุฏุฑุฌุงุชโ ุจุณุฑุนุฉ ุจุฏูู ุชุดุชุช.</p>
          </div>
        `);
      } else if (examWin === "14days") {
        planBlocks.push(`
          <div class="plan-block">
            <h3>2) ุฎุทุฉ ุฃุณุจูุนูู</h3>
            <ol>
              <li><strong>ุฃูู 4 ุฃูุงู:</strong> ุชุฃุณูุณ ุณุฑูุน ููููุงุนุฏ + ุชุทุจูู.</li>
              <li><strong>ุงูููู 5-8:</strong> Reading + Listening (ุงุณุชุฑุงุชูุฌูุงุช + ููุงุฐุฌ).</li>
              <li><strong>ุงูููู 9-12:</strong> ุชุฌููุนุงุช/ููุงุฐุฌ + ุชุตุญูุญ ุตุงุฑู ููุฃุฎุทุงุก.</li>
              <li><strong>ุงูููู 13-14:</strong> ูููุฐุฌูู ุฎููู + ูุฑุงุฌุนุฉ ุฃูู ุงูููุงุท.</li>
            </ol>
            <p class="muted">ุงููุฏู ููุง: ุชุฑูุน ูุณุชูุงู ุจุณุฑุนุฉ ูุชุซุจุช ููุงุทู ุงูุถุนููุฉ.</p>
          </div>
        `);
      } else {
        planBlocks.push(`
          <div class="plan-block">
            <h3>2) ุฎุทุฉ ุดูุฑ / ุดูุฑูู / ุฃูุซุฑ</h3>
            <ol>
              <li><strong>ูุฑุญูุฉ 1:</strong> ุชุฃุณูุณ (Grammar + ููุงููู) + ุงุฎุชุจุงุฑ ูุตูุฑ ูููู.</li>
              <li><strong>ูุฑุญูุฉ 2:</strong> Reading/Listening ุงุณุชุฑุงุชูุฌูุงุช + ุชุทุจูู ุนูู ููุงุฐุฌ.</li>
              <li><strong>ูุฑุญูุฉ 3:</strong> ููุงุฐุฌ ูุชุฌููุนุงุช + ุชุตุญูุญ ุฃุฎุทุงุก + ุฑูุน ุงูุณุฑุนุฉ.</li>
              <li><strong>ูุฑุญูุฉ 4:</strong> ูุฑุงุฌุนุงุช ููุงุฆูุฉ + ุชุซุจูุช ุงููุชูุฑุฑ.</li>
            </ol>
            <p class="muted">ุงููุฏู ููุง: ุชุฃุณูุณ ููู ุซู ุชูุซูู ุฐูู ุนูู ุงูููุงุฐุฌ.</p>
          </div>
        `);
      }

      // ุชูุตูุงุช ุญุณุจ ุงูุฃููู
      if (strong.length) {
        planBlocks.push(`
          <div class="plan-block">
            <h3>3) ููุทุฉ ููุชู</h3>
            <ul>
              <li>ูุงุถุญ ุฅู ${esc(strong[0])} ุนูุฏู ุฃูุถู ูู ุบูุฑูโฆ ูุง ุชููููุ ุจุณ ุฎูู ูุฑุงุฌุนุฉ ุณุฑูุนุฉ.</li>
              <li>ุงูุชุฑููุฒ ุงูุฃูุจุฑ ูููู ุนูู ููุงุท ุงูุถุนู + ุญู ููุงุฐุฌ.</li>
            </ul>
          </div>
        `);
      }

      // ุขุฎุฑ ุณุทุฑ ุฅููุงุนู ุจุฏูู ูุจุงูุบุฉ
      planBlocks.push(`
        <div class="plan-block plan-block--cta">
          <h3>4) ููู ุงูุชุณุฌูู ุงูุขูุ</h3>
          <ul>
            <li>ุจุชุฏุฎู ุนูู ูุญุชูู ูุฑุชุจ ุจุฏู ุงูุชุดุชุช ุจูู ูุตุงุฏุฑ ูุซูุฑุฉ.</li>
            <li>ุจุชุนุฑู ูุด ุชุฐุงูุฑ โุจุงูุถุจุทโ ุญุณุจ ูุณุชูุงู.</li>
            <li>ุงูุชูุนูู ูุชู ุจุฃูุฑุจ ููุช ุจุนุฏ ูุตูู ุงูุญูุงูุฉ ูุฅุฑุณุงู ุงูุฅูุตุงู.</li>
          </ul>
          <div class="actions">
            <a class="btn btn--primary" href="./register.html">ุฃููู ุงูุชุณุฌูู ุงูุขู โ</a>
            <a class="btn btn--ghost" href="./faq.html">ุนูุฏู ุงุณุชูุณุงุฑ ุณุฑูุน</a>
          </div>
        </div>
      `);

      return {
        introHtml: lines.join(""),
        bodyHtml: planBlocks.join("")
      };
    }

    // ========== ุนุฑุถ ุงููุฑุงุฌุนุฉ ==========
    function renderReview(review) {
      const wrong = (review || []).filter(r => r.chosen !== r.answer).slice(0, 8); // ูุฎุชุตุฑ
      if (!wrong.length) {
        reviewWrap.innerHTML = `
          <div class="empty-state">
            ูุง ุดุงุก ุงูููโฆ ูุง ุนูุฏู ุฃุฎุทุงุก ูุงุถุญุฉ ูู ูุงูุงุฎุชุจุงุฑ ๐
            <div class="muted">ุฑูุฒ ุนูู ุงูููุงุฐุฌ ูุงูุชุฌููุนุงุช ูุจุชุทูุน ุฏุฑุฌุฉ ูููุฉ ุจุฅุฐู ุงููู.</div>
          </div>
        `;
        return;
      }

      reviewWrap.innerHTML = wrong.map((r, i) => {
        const chosenTxt = typeof r.chosen === "number" ? r.choices[r.chosen] : "โ";
        const answerTxt = typeof r.answer === "number" ? r.choices[r.answer] : "โ";
        return `
          <div class="review-item">
            <div class="review-item__head">
              <span class="pill">${esc(r.section)}</span>
              <span class="pill pill--ghost">${esc(r.tag || "STEP")}</span>
              <span class="muted">ุฎุทุฃ #${i+1}</span>
            </div>
            <div class="review-item__q">${esc(r.prompt)}</div>
            <div class="review-item__a">
              <div><strong>ุฅุฌุงุจุชู:</strong> ${esc(chosenTxt)}</div>
              <div><strong>ุงูุตุญูุญ:</strong> ${esc(answerTxt)}</div>
            </div>
            ${r.explanation ? `<div class="review-item__exp">${esc(r.explanation)}</div>` : ""}
          </div>
        `;
      }).join("");
    }

    // ========== ุชุดุบูู ุงูุตูุญุฉ ==========
    try {
      if (!dataRaw) throw new Error("no data");
      const payload = JSON.parse(dataRaw);

      const prof = payload.profile || {};
      const result = payload.result || {};
      const perSection = result.perSection || {};

      // ุนุฑุถ
      noResult.style.display = "none";
      resultWrap.style.display = "";

      scorePercent.textContent = (result.percent ?? "โ") + "%";
      scoreRaw.textContent = `${result.correct ?? "โ"} / ${result.total ?? "โ"}`;
      examWindowText.textContent = windowLabel(prof.examWindow);

      // ุชุญููู ุงูุฃูุณุงู
      const rows = Object.entries(perSection).map(([sec, v]) => {
        const acc = v.total ? (v.correct / v.total) : 0;
        return { sec, correct: v.correct, total: v.total, acc };
      }).sort((a,b) => a.acc - b.acc);

      sectionBars.innerHTML = rows.map(r => {
        const percent = r.total ? Math.round((r.correct / r.total) * 100) : 0;
        return `
          <div class="bar">
            <div class="bar__top">
              <span class="bar__label">${esc(r.sec)}</span>
              <span class="bar__value">${r.correct}/${r.total} (${percent}%)</span>
            </div>
            <div class="bar__track">
              <div class="bar__fill" style="width:${percent}%"></div>
            </div>
          </div>
        `;
      }).join("");

      // ููุงุท ุงูุถุนู
      const weak = rows.slice(0, 3);
      weakList.innerHTML = weak.map(w => {
        const percent = w.total ? Math.round((w.correct / w.total) * 100) : 0;
        return `
          <li class="focus-item">
            <span class="focus-item__name">${esc(w.sec)}</span>
            <span class="focus-item__meta">${percent}% โ ูุฑูุนูุง ุจุฎุทุฉ ูุฑูุฒุฉ</span>
          </li>
        `;
      }).join("");

      // ุงูุฎุทุฉ
      const plan = buildPlan(prof, perSection);
      planIntro.innerHTML = plan.introHtml;
      planBody.innerHTML = plan.bodyHtml;

      // ุงูููุงุนุฏ
      const s = initSeats();
      paintSeats(s.seats, s.note);

      // ุงููุฑุงุฌุนุฉ
      renderReview(result.review || []);

    } catch (e) {
      // ูุง ููู ูุชูุฌุฉ
      noResult.style.display = "";
      resultWrap.style.display = "none";
    }
  </script>
</body>
</html>
