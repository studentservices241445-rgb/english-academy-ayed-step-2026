<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ูุชูุฌุฉ ุงูุงุฎุชุจุงุฑ ูุงูุฎุทุฉ | ุฃูุงุฏูููุฉ ุนุงูุฏ โ STEP 2026</title>
  <meta name="description" content="ุนุฑุถ ูุชูุฌุฉ ุงุฎุชุจุงุฑ ุชุญุฏูุฏ ุงููุณุชูู ูุฎุทุฉ ูุฐุงูุฑุฉ ูุฎุตุตุฉ ุญุณุจ ูุณุชูุงู ูููุนุฏ ุงุฎุชุจุงุฑู." />

  <!-- Styles -->
  <link rel="stylesheet" href="./assets/styles.css?v=2026-01-20" />

  <!-- (ุงุฎุชูุงุฑู ูุงุญููุง ูููPWA) -->
  <link rel="manifest" href="./manifest.json?v=2026-01-20" />
  <meta name="theme-color" content="#0b0b0f" />
</head>

<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="./index.html">
        <span class="brand__mark">โ</span>
        <span class="brand__text">ุฃูุงุฏูููุฉ ุนุงูุฏ โ STEP 2026</span>
      </a>

      <nav class="nav">
        <a class="nav__link" href="./index.html">ุงูุฑุฆูุณูุฉ</a>
        <a class="nav__link" href="./course-content.html">ูุญุชูู ุงูุฏูุฑุฉ</a>
        <a class="nav__link" href="./faq.html">ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ</a>
        <a class="nav__link" href="./level-test.html">ุงุฎุชุจุงุฑ ุชุญุฏูุฏ ุงููุณุชูู</a>
        <a class="nav__link nav__cta" href="./register.html" aria-disabled="true" title="ุงูุชุณุฌูู ููุชุญ ุจุนุฏ ุงูุงุฎุชุจุงุฑ">ุงูุชุณุฌูู</a>
      </nav>
    </div>
  </header>

  <main class="container" style="padding-top: 1.2rem; padding-bottom: 3rem;">
    <section class="card" id="resultsApp" aria-live="polite">
      <!-- Filled by script -->
    </section>
  </main>

  <!-- ูุณุงุนุฏ/ุชูุณุชุงุช ุนุงู (ุฅุฐุง ููุฌูุฏ ุนูุฏู) -->
  <script src="./assets/app.js?v=2026-01-20"></script>

  <script>
    (() => {
      "use strict";

      const KEY = "ayed_step_leveltest_v2026_01_20:result";
      const $app = document.getElementById("resultsApp");

      const escapeHtml = (s) =>
        String(s ?? "")
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");

      const readableSection = (sec) => {
        sec = (sec || "").toLowerCase();
        if (sec === "grammar") return "Grammar (ุงูููุงุนุฏ)";
        if (sec === "reading") return "Reading (ุงููุฑุงุกุฉ)";
        if (sec === "listening") return "Listening (ุงูุงุณุชูุงุน)";
        if (sec === "vocab") return "Vocabulary (ุงูููุฑุฏุงุช)";
        return "General (ุนุงู)";
      };

      const gradeLabel = (pct) => {
        if (pct >= 90) return "ููุชุงุฒ ุฌุฏูุง ๐ฅ";
        if (pct >= 80) return "ููุชุงุฒ ๐";
        if (pct >= 70) return "ุฌูุฏ ุฌุฏูุง โ";
        if (pct >= 60) return "ุฌูุฏ ๐";
        return "ูุญุชุงุฌ ุดุฏู ุญูู ุจุณูุท ๐ช";
      };

      function renderEmpty() {
        $app.innerHTML = `
          <div class="card__head">
            <h1 class="h1">ูุง ููููุง ูุชูุฌุฉ</h1>
            <p class="muted">ูุงุฒู ุชููู ุงุฎุชุจุงุฑ ุชุญุฏูุฏ ุงููุณุชูู ุฃููุ ูุจุนุฏูุง ูุทูุน ูู ุงูุฎุทุฉ ูุงูุณุนุฑ.</p>
          </div>

          <div class="stack">
            <div class="note">
              ุฅุฐุง ูุชุญุช ุงูุตูุญุฉ ูู ุฌูุงุฒ ุซุงูู ุฃู ูุถุน ุฎุงุต ุจุฏูู ูุง ุชุณูู ุงูุงุฎุชุจุงุฑุ ุทุจูุนู ูุง ุชุธูุฑ ุงููุชูุฌุฉ.
            </div>

            <div class="actions">
              <a class="btn btn-primary" href="./level-test.html">ุงุจุฏุฃ ุงุฎุชุจุงุฑ ุชุญุฏูุฏ ุงููุณุชูู</a>
              <a class="btn btn-ghost" href="./index.html">ุฑุฌูุน ููุฑุฆูุณูุฉ</a>
            </div>
          </div>
        `;
      }

      function render(payload) {
        const profile = payload.profile || {};
        const quiz = payload.quiz || {};
        const plan = payload.plan || {};
        const pricing = payload.pricing || { discountedPriceSar: 349, regularPriceSar: 599, currency: "SAR" };

        const name = profile.name ? `ูุง ${escapeHtml(profile.name)}` : "ูุง ุจุทู";
        const pct = Number(quiz.pct || 0);
        const correct = Number(quiz.correct || 0);
        const total = Number(quiz.total || 0);

        const sections = Array.isArray(quiz.bySection) ? quiz.bySection : [];
        const wrong = Array.isArray(quiz.wrongItems) ? quiz.wrongItems : [];

        const sectionRows = sections.map(s => {
          const sp = Number(s.pct || 0);
          return `
            <tr>
              <td>${escapeHtml(readableSection(s.section))}</td>
              <td>${escapeHtml(String(s.correct ?? 0))} / ${escapeHtml(String(s.total ?? 0))}</td>
              <td><strong>${escapeHtml(String(sp))}%</strong></td>
            </tr>
          `;
        }).join("");

        const wrongCards = wrong.slice(0, 10).map(w => {
          const picked = Number.isInteger(w.pickedIndex) ? w.pickedIndex : -1;
          const ans = Number.isInteger(w.answerIndex) ? w.answerIndex : -1;
          const pickedL = picked >= 0 ? String.fromCharCode(65 + picked) : "โ";
          const ansL = ans >= 0 ? String.fromCharCode(65 + ans) : "โ";
          return `
            <div class="mini-card">
              <div class="mini-card__top">
                <span class="pill">${escapeHtml(readableSection(w.section))}</span>
                <span class="muted">ุฅุฌุงุจุชู: <strong>${escapeHtml(pickedL)}</strong> โ ุงูุตุญูุญ: <strong>${escapeHtml(ansL)}</strong></span>
              </div>
              <div class="mini-card__q">${escapeHtml(w.prompt || "")}</div>
              ${w.explain ? `<div class="mini-card__explain">${escapeHtml(w.explain)}</div>` : ""}
            </div>
          `;
        }).join("");

        const planBullets = Array.isArray(plan.bullets) ? plan.bullets : [];
        const planHtml = planBullets.map(b => {
          // allow simple markdown-like bold **text**
          const safe = escapeHtml(b).replaceAll(/\*\*(.+?)\*\*/g, "<strong>$1</strong>").replaceAll("\n", "<br/>");
          return `<div class="plan-line">${safe}</div>`;
        }).join("");

        const showPrice = payload?.flags?.showPrice !== false;

        $app.innerHTML = `
          <div class="card__head">
            <h1 class="h1">ูุชูุฌุชู ูุฎุทุชู</h1>
            <p class="muted">ุชู ุชุฌููุฒ ุฎุทุฉ ุนูู ูุฏ ููุชู ููุณุชูุงู โ ุจุฏูู ุชุดุชุช ๐</p>
          </div>

          <div class="stack">
            <div class="hero-metric">
              <div class="hero-metric__left">
                <div class="muted">${name}ุ ูุชูุฌุชู ุงูุญุงููุฉ:</div>
                <div class="score">${escapeHtml(String(pct))}%</div>
                <div class="muted">${escapeHtml(gradeLabel(pct))} โ (${escapeHtml(String(correct))}/${escapeHtml(String(total))})</div>
              </div>
              <div class="hero-metric__right">
                <div class="note">
                  <strong>ุงูุขู ูุด ุชุณููุ</strong><br/>
                  ุงุชุจุน ุงูุฎุทุฉ ุชุญุชุ ูุจุนุฏูุง ุณุฌูู ุนุดุงู ุชูุตูู ูููุงุช ุงูุฏูุฑุฉ ููููุงุช ุงููุชุงุจุนุฉ ุจุฃูุฑุจ ููุช.
                </div>
              </div>
            </div>

            <div class="grid2">
              <div class="card card--inner">
                <h2 class="h2">ุชุญููู ุงูุฃูุณุงู</h2>
                <div class="muted">ูุฐุง ููุถุญ ูู ููู ุชุฑูุฒ ุฃูุซุฑ.</div>
                <div class="table-wrap">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>ุงููุณู</th>
                        <th>ุงููุชูุฌุฉ</th>
                        <th>ุงููุณุจุฉ</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${sectionRows || `<tr><td colspan="3" class="muted">ูุง ููุฌุฏ ุชุญููู ุฃูุณุงู ูุชุงุญ</td></tr>`}
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="card card--inner">
                <h2 class="h2">ุฎุทุฉ ูุฐุงูุฑุฉ ููุชุฑุญุฉ</h2>
                <div class="muted">${escapeHtml(plan.summary || "")}</div>
                <div class="plan">
                  ${planHtml || `<div class="muted">ุงูุฎุทุฉ ุบูุฑ ูุชุงุญุฉ ุญุงูููุง.</div>`}
                  ${plan.closing ? `<div class="plan-close">${escapeHtml(plan.closing).replaceAll("\n","<br/>")}</div>` : ``}
                </div>

                <div class="actions" style="margin-top: .9rem;">
                  <a class="btn btn-primary" href="./register.html">ุงุจุฏุฃ ุงูุชุณุฌูู ูุชุฃููุฏ ุงูุฏูุน</a>
                  <a class="btn btn-ghost" href="./course-content.html">ุดูู ูุญุชูู ุงูุฏูุฑุฉ ุจุงูุชูุตูู</a>
                </div>
              </div>
            </div>

            <div class="card card--inner">
              <h2 class="h2">ุฃุฎุทุงุกู (ูุฎุชุตุฑ ููููุฏ)</h2>
              <div class="muted">ุนุฑุถูุง ูู ุฃูู ุงูุฃุฎุทุงุก ุนุดุงู ุชุนุฑู โุณุจุจ ุงูุบูุทโ ูู ุจุณ ุงูุฅุฌุงุจุฉ.</div>
              ${wrongCards ? `<div class="mini-grid">${wrongCards}</div>` : `<div class="note">ูุง ุดุงุก ุงููู! ูุง ุนูุฏู ุฃุฎุทุงุก ูุซูุฑุฉ ๐</div>`}
            </div>

            <div class="card card--inner">
              <h2 class="h2">ุงูุงุดุชุฑุงู</h2>
              <div class="muted">ุงูุณุนุฑ ูุธูุฑ ุจุนุฏ ุงูุงุฎุชุจุงุฑ ููุท โ</div>

              ${showPrice ? `
                <div class="price-box">
                  <div class="price-main">
                    <div class="price-now">${escapeHtml(String(pricing.discountedPriceSar || 349))} ุฑูุงู</div>
                    <div class="price-sub muted">ุจุฏู ${escapeHtml(String(pricing.regularPriceSar || 599))} ุฑูุงู</div>
                  </div>
                  <div class="price-note">
                    <div class="note">
                      <strong>ูุนูููุฉ:</strong> ุงูููุงุนุฏ ูุญุฏูุฏุฉ โ ูุฅุฐุง ุงูุชููุช ูุฑุฌุน ุงูุณุนุฑ ุงูุฑุณูู ุชููุงุฆููุง.
                    </div>
                  </div>
                </div>
              ` : `
                <div class="note">ุฃููู ุงูุงุฎุชุจุงุฑ ุนุดุงู ูุธูุฑ ูู ุงูุณุนุฑ.</div>
              `}

              <div class="actions" style="margin-top: .9rem;">
                <a class="btn btn-primary" href="./register.html">ุณุฌูู ุงูุขู (ุชุฃููุฏ ุงูุฏูุน)</a>
                <a class="btn btn-ghost" href="./level-test.html">ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ</a>
              </div>
            </div>

            <div class="muted" style="text-align:center;">
              ุฅุฐุง ุชุญุณ ุงููุชูุฌุฉ ูุง ุชูุซูู ูุณุชูุงู (ููุช ูุณุชุนุฌู/ูุดุชุช)ุ ุนุงุฏู ุฃุนุฏ ุงูุงุฎุชุจุงุฑโฆ ุงูุฃุณุฆูุฉ ุชุชุบููุฑ.
            </div>
          </div>
        `;

        // Disable register CTA in header ONLY if you want to force the flow:
        // Here we keep it clickable from results.
        const headerCta = document.querySelector(".nav__cta");
        if (headerCta) {
          headerCta.removeAttribute("aria-disabled");
          headerCta.removeAttribute("title");
          headerCta.setAttribute("href", "./register.html");
        }
      }

      let payload = null;
      try {
        payload = JSON.parse(localStorage.getItem(KEY) || "null");
      } catch (e) {}

      if (!payload || !payload.quiz) renderEmpty();
      else render(payload);
    })();
  </script>
</body>
</html>
